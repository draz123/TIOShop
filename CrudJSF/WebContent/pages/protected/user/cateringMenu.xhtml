<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets">
<h:head>
	<h:outputStylesheet library="css" name="main.css" />
</h:head>
<h:body>
	<h:form>
		<h3>
			#{msgs.loginHello}: #{userMB.user.name} ||
			<h:commandLink action="#{userMB.logOut()}" value="#{msgs.logout}" />
		</h3>

		<h:messages />


		<h:commandButton value="Add category" action="addCategory" />
		<h:commandButton value="Add Meal" action="#{addMealMB.addMealStart()}" />

		<h:dataTable value="#{cateringMenuMB.allCategories}" var="category"
			styleClass="table" headerClass="tableColumnsHeader"
			rowClasses="tableFirstLine,tableNextLine">
			<h:column>
				<f:facet name="header">
					Categories								
				</f:facet>
					#{category.title}
			</h:column>
			<h:column>
				<h:commandButton action="addCategory" value="#{msgs.update}"
					rendered="#{userMB.userAdmin}">
					<f:setPropertyActionListener target="#{addMealMB.editFlag}"
						value="true" />
					<f:setPropertyActionListener target="#{addMealMB.category}"
						value="#{category}" />
				</h:commandButton>
				<h:commandButton
					action="#{cateringMenuMB.deleteCategoryEnd(category)}"
					value="#{msgs.delete}" rendered="#{userMB.userAdmin}">
				</h:commandButton>
			</h:column>
			<h:column>
				<h:dataTable value="#{cateringMenuMB.allMeals}" var="meal"
					styleClass="table" headerClass="tableColumnsHeader"
					rowClasses="tableFirstLine,tableNextLine">
					<h:column rendered="#{category.id==meal.category.id}">
						<f:facet name="header">							
							Meals						
						</f:facet>
						<h:outputText value="#{meal.name}" />
					</h:column>
					<h:column>
						<h:panelGrid columns="4"
							rendered="#{category.id==meal.category.id}">
							<ul>
								<ui:repeat value="#{cateringMenuMB.allIngredients}"
									var="ingredient">
									<h:panelGrid columns="4"
										rendered="#{ingredient.meal.id==meal.id}">
										<li><h:outputText
												value="#{ingredient.name} - #{ingredient.weight}g" /></li>
									</h:panelGrid>
								</ui:repeat>
							</ul>
						</h:panelGrid>
					</h:column>
					<h:column>
						<h:graphicImage value="/resources/images/kielbasa.png" width="200"
							height="150" rendered="#{category.id==meal.category.id}" />
					</h:column>
					<h:column>
						<h:panelGrid columns="4"
							rendered="#{category.id==meal.category.id}">
							<!-- Always save the id as hidden when you use a request scope MB -->
							<h:commandButton action="#{addMealMB.addMealStart()}"
								value="#{msgs.update}" rendered="#{userMB.userAdmin}">
								<f:setPropertyActionListener target="#{addMealMB.meal}"
									value="#{meal}" />
								<f:setPropertyActionListener target="#{addMealMB.editFlag}"
									value="true" />

							</h:commandButton>
							<h:commandButton action="#{cateringMenuMB.deleteMealStart(meal)}"
								value="#{msgs.delete}" rendered="#{userMB.userAdmin}">
								<f:setPropertyActionListener target="#{cateringMenuMB.category}"
									value="#{category}" />
							</h:commandButton>
						</h:panelGrid>
					</h:column>
				</h:dataTable>
			</h:column>
		</h:dataTable>
	</h:form>
</h:body>
</html>